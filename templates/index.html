<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>PROSIT</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="https://code.jquery.com/ui/1.12.1/themes/ui-lightness/jquery-ui.css" rel="stylesheet"/>
    <link href="../css/style.css" rel="stylesheet">
    <link href="../css/parallelCordMBostock.css" rel="stylesheet">     
</head>

<body>
    <!-- ✅ load bootstrap ✅ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <!-- ✅ load jQuery ✅ -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <!-- ✅ load jQuery UI ✅ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- ✅ load libraries for multiselect dropdown ✅ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/1.1.1/js/bootstrap-multiselect.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/1.1.1/css/bootstrap-multiselect.css">
    <!-- AG-grid -->
    <script src="https://unpkg.com/ag-grid-enterprise@27.0.1/dist/ag-grid-enterprise.min.js"></script>
    
    <div class="container-fluid p-20" style="height:100%">
        <div class="row flex-nowrap" style="height:100%">
            
            <!-- sidebar -->
            <div class="col-auto px-0">
                <div id="sidebar" class="collapse collapse-horizontal show">
                <!-- show is used here to hide or show the sidebar by default-->
                    <div id="sidebar-nav" class="list-group border-0 rounded-0 text-sm-start min-vh-100">

                        <img src="../img/PROSIT.PNG" alt="PROSIT" style="display: block; margin-left:auto; margin-right: auto; width: 50%;">
                        <h5 id="dashboardHeader" style="margin:0; padding: 0; text-align:center; color:rgb(18, 113, 249)">PROSIT</h5>
                        <hr class="line">

                        <!-- search bar to search specific participant -->
                        <div style="margin: 0; padding-left: 10px; padding-right: auto;" class="input-group input-group-sm">
                            <input type="text" id="searchSelector" class="form-control" placeholder="Search participantId" aria-label="Search" stlye="text-align: center;"/>
                        </div>
                        <hr class="line">

                        <!-- multi select dropdown -->
                        <div style="padding-left:10px; text-align: center;">
                            <label>Feature selection</label>
                            <select id="featureSelect" multiple>
                            <optgroup label="Screen">
                                <option value="noScreenLocks" selected="selected">No of Unlocks</option>
                                <option value="firstScreenUnlock" selected="selected">First Screen Unlock</option>
                                <option value="lastScreenLock" selected="selected">Last Screen Lock</option>
                                <option value="maxScreenTime" selected="selected">Max On time</option>
                                <option value="totalScreenTime" selected="selected">Total On time</option>
                            </optgroup>

                            <optgroup label="Calling">
                                <option value="noMissed" selected="selected">No of missed calls</option>
                                <option value="noDialled" selected="selected">No of dialed calls</option>
                                <option value="noIncoming" selected="selected">No of incoming calls</option>
                                <option value="minDurationIncoming" selected="selected">Min dur of incoming calls</option>
                                <option value="maxDurationIncoming" selected="selected">Max dur of incoming calls</option>
                                <option value="totalDurationIncoming" selected="selected">Total dur of incoming calls</option>
                                <option value="noOutgoing" selected="selected">No of outgoing calls</option>
                                <option value="minDurationOutgoing" selected="selected">Min dur of outgoing calls</option>
                                <option value="maxDurtaionOutgoing" selected="selected">Max dur of outgoing calls</option>
                                <option value="totalDurationOutgoing" selected="selected">Total dur of outgoing calls</option>
                                <option value="totalNoCalls" selected="selected">Total number of calls</option>
                                <option value="totalDurationCalls" selected="selected">Total dur of all calls</option>
                            </optgroup>

                            <!-- <optgroup label="Mobility">
                                <option value="noOfStayPoints" selected="selected">No of stay points</option>
                                <option value="locationVariance" selected="selected">Location Variance</option>
                                <option value="entropy" selected="selected">Entropy</option>
                                <option value="normalizedEntropy" selected="selected">Normalized Entropy</option>
                                <option value="homeStay" selected="selected">Home stay</option>
                                <option value="radiusOfGyration" selected="selected">Radius of Gyration</option>
                            </optgroup> -->

                            <optgroup label="Sleep">
                                <option value="sleepStartTime" selected="selected">Sleep start Time</option>
                                <option value="sleepEndTime" selected="selected">Sleep end Time</option>
                                <option value="sleepDuration" selected="selected">Sleep duration</option>
                            </optgroup>
                        </select>
                        </div>
                        <hr class="line">

                        <!-- slider for radius of glyph -->
                        <div class="slidecontainer" style="text-align: center; padding-left:10px; padding-bottom:0px; margin-bottom:0px;">
                            <label style="font-size: 15px;">Glyph Radius: </label>
                            <span style="font-size: 15px;" id="sliderVal"></span>
                            <br>
                            <div>
                                <input type="range" min="5" max="25" value="8" steps='1' class="slider" id="myRange">
                            </div>
                        </div>
                        <hr class="line">
                        
                        <!-- k-param -->
                        <div class="num-block skin-1 scaled">
                            <div style="text-align: center;">
                                <label style="font-size: 15px; font-weight:500; ">k param for knn</label>
                            </div>
                            <div class="num-in">
                                <span class="minus"></span>
                                <input type="text" class="in-num" value="3">
                                <span class="plus"></span>
                            </div>
                        </div>
                        <hr class="line">

                        <!-- Toggle glyph switch -->
                        <div style="text-align: center;" class="scaled">
                            <label class="form-check-label selectedLabel" id="radialSwitch" for="toggleGlyph" style="text-align: center; font-size: 15px;">Radial Glyph</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="toggleGlyph" unchecked/>
                            </div>
                            <label class="form-check-label" id="flowerSwitch" for="toggleGlyph" style="text-align: center; font-size: 15px;">Flower Glyph</label>
                        </div>
                        <hr class="line">

                        <!-- Toggle Dimensionality Reduction technique TSNE/PCA -->
                        <div style="text-align: center;" class="scaled">
                            <label class="form-check-label selectedLabel" id="tsneSwitch" for="toggleDimRedux" style="text-align: center; font-size: 15px;">TSNE</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="toggleDimRedux" unchecked/>
                            </div>
                            <label class="form-check-label" id="pcaSwitch" for="toggleDimRedux" style="text-align: center; font-size: 15px;">PCA</label>
                        </div>
                        <hr class="line">

                        <!-- Toggle Overlap removal -->
                        <div style="text-align: center;" class="scaled">
                            <label class="form-check-label selectedLabel" id="useDGrid" for="toggleDGrid" style="text-align: center; font-size: 15px;">Remove Overlap</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="toggleDGrid" unchecked/>
                            </div>
                            <label class="form-check-label" id="noUseDGrid" for="toggleDGrid" style="text-align: center; font-size: 15px;">Keep Overlap</label>
                        </div>
                        <hr class="line">

                        <!-- Show labels switch -->
                        <div style="text-align: center;" class="scaled">
                            <label class="form-check-label selectedLabel" id="hideLabels" for="toggleLabels" style="text-align: center; font-size: 15px;">Hide Labels</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="toggleLabels" unchecked/>
                            </div>
                            <label class="form-check-label" id="showLables" for="toggleLabels" style="text-align: center; font-size: 15px;">Show Lables</label>
                        </div>
                        <hr class="line">

                        <!-- Show grid switch -->
                        <div style="text-align: center;" class="scaled">
                            <label class="form-check-label selectedLabel" id="showSvgGrid" for="toggleSvgGrid" style="text-align: center; font-size: 15px;">Show Grid</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="toggleSvgGrid" unchecked/>
                            </div>
                            <label class="form-check-label" id="hideSvgGrid" for="toggleSvgGrid" style="text-align: center; font-size: 15px;">Hide Grid</label>
                        </div>
                        <hr class="line">

                        <!-- checkboxes for coloring glyphs -->
                        <div>
                            <table style="width:100%;" id="colorCheckbox">
                                <tr>
                                    <td class="filterCheckbox">
                                        <input type="checkbox" class="radio" value="age"  name="colorCheckbox" checked/>
                                        <br>
                                        <label>Age</label>
                                    </td>
                                    <td class="filterCheckbox">
                                        <input type="checkbox" class="radio" value="gender" name="colorCheckbox" />
                                        <br>
                                        <label>Gender</label>
                                    </td>
                                    <td class="filterCheckbox">
                                        <input type="checkbox" class="radio" value="dass" name="colorCheckbox" />
                                        <br>
                                        <label>D1</label>
                                    </td>
                                    <td class="filterCheckbox">
                                        <input type="checkbox" class="radio" value="current_diagnosis" name="colorCheckbox" />
                                        <br>
                                        <label>D2</label>
                                    </td>
                                </tr>
                            </table>

                        </div>

                        <hr class="line">

                        <div>
                            <table style="width:100%;">
                                <tr>
                                    <td class="filterCheckbox">
                                        <input type="checkbox" id="lckCheckBox">
                                        <br>
                                        <label>LCK</label>
                                    </td>
                                    <td class="filterCheckbox">
                                        <input type="checkbox" id="brtCheckBox" checked>
                                        <br>
                                        <label>BRT</label>
                                    </td>
                                    <td class="filterCheckbox">
                                        <input type="checkbox" id="accCheckBox">
                                        <br>
                                        <label>ACC</label>
                                    </td>
                                    <td class="filterCheckbox">
                                        <input type="checkbox" id="gyrCheckBox">
                                        <br>
                                        <label>GYR</label>
                                    </td>
                                    <td class="filterCheckbox">
                                        <input type="checkbox" id="sleepNoiseCheckBox">
                                        <br>
                                        <label>Noise</label>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <hr class="line">
                        

                        <!-- submit button -->
                        <div style="display:flex; justify-content: center; align-items: center;" class="scaled">
                            <button type="button" class="btn btn-outline-primary btn-sm" id="Submit">Submit</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- main -->
            <main class="col ps-md-2 pb-10">
                <div class="ma-5" id="dashboard">
                    <hline>
                    <div id="gui"></div>
                    <svg class="svg1" id="chart1"></svg>
                    <svg class="svg2" id="chart2"></svg>
                    <svg class="svg3" id="chart3"></svg>
                    <svg class="svg3" id="chart4"></svg>
                </div>

                <div class="row py-2" id="header">
                    <div class="col-4 py-1">
                        <a data-toggle="collapse" href="#" data-target="#sidebar" aria-expanded="false">Menu</a>
                    </div>
                    <div class="btn-toolbar col-8 justify-content-end" role="toolbar" aria-label="Toolbar with button groups">
                        <div class="btn-group btn-group-sm mt-2 mr-2" role="group" aria-label="First group">
                          <button type="button" class="btn btn-light" onclick="onBtnImport()">show csv</button>
                          <button type="button" class="btn btn-light" onclick="onBtnRemove()">hide csv</button>
                          <!-- <button type="button" class="btn btn-light" onclick="onBtnUpdate()"> update csv</button>
                          <button type="button" class="btn btn-light" onclick="onBtnExport()">download csv</button> -->
                        </div>
                    </div>
                <div id="csvGrid" class="grid ag-theme-balham mt-2" style="display: none;"></div>
                <br>
            </main>
        </div>
    </div>

    <script> 
    //settings for multiselect dropdown
    $('#featureSelect').multiselect({
        enableClickableOptGroups: true,
        enableCollapsibleOptGroups: true,
        enableFiltering: true,
        filterPlaceholder: 'Search',
        includeSelectAllOption: true,
        buttonWidth: '140px',
        maxHeight: screen.height * 0.6,
        // buttonClass: 'btn btn-link',
        numberDisplayed: 1
    })

    $.ajax({
            type: "GET",
            contentType: 'application/json',
            url: "/getIds",
            success: function(Ids) {
                $("#searchSelector").autocomplete({
                    source: Ids
                });
            }
        });
    

    // Calling server route to find dim reduce for all columns - run at the begining of page refresh/first load
    featurelist = $('#featureSelect').val()
    w = Math.floor($('.svg1')[0].getBoundingClientRect().width);
    h = Math.floor($('.svg1')[0].getBoundingClientRect().height)
    radius = +document.getElementById("myRange").value
    k = $('.num-in span').parents('.num-block').find('input.in-num').val()
    toggleDimRedux = "TSNE"
    toggleDGrid = true
    var postForm = {
        "featureColumns": featurelist,
        "width": w,
        "height": h,
        "radius": radius,
        "k": k,
        "toggleDimRedux": toggleDimRedux,
        "toggleDGrid": toggleDGrid
    }
    $.ajax({
        type: "POST",
        contentType: 'application/json',
        data: JSON.stringify(postForm),
        url: "/dimReduceIds"
    })

    </script>
    
    <!-- Imports -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https:/d3js.org/d3-scale-chromatic.v0.3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <script src="../js/d3-lasso.min.js"></script>

    <!-- PROSIT Charts -->
    <!-- glyphs scatter plot : svg1 -->
    <script src="../js/glyphs.js"></script>
    <!-- spiral time chart : svg2 -->
    <script src="../js/radialTimeChart.js"></script>
    <!-- parallel cordinate chart : svg3 & svg4 -->
    <script src="../js/parallelCoordinateChart.js"></script>
    <!-- loading symbol during buffer -->
    <script src="../js/buffering.js"></script>
    
    <script>
    // config
    var glyphsChart ="chart1";
    var radialTimeChart ="chart2";
    var parallelCordChart1 ="chart3";
    var parallelCordChart2 ="chart4";
    var ids
    var selectedId
    var featurelist = $('#featureSelect').val()
    var radius  = document.getElementById("myRange").value;
    var k
    var toggleGlyph //'radialGlyph' for radial glyph and 'flowerGlyph' for flower glyph
    var toggleDimRedux
    var toggleDGrid
    var toggleLabels //true for showing labels
    var toggleSvgGrid //true for showing the grid
    var glyphColor
    var lckChecked
    var brtChecked
    var accChecked
    var gyrChecked
    var noiseChecked
    var delayInMilliseconds = 750

    // jquery handlers for showing chart for random data on screen
    {
        // set a  ramdom value to select an id 
        $.ajax({
            type: "GET",
            async: false,
            url: "/getIds",
            success: function(response) {
                ids = response
                selectedId = ids[Math.floor(Math.random() * ids.length)]
            }
        })
        renderCharts()
    }

    // jquery handlers for initially setting the values of variables
    {        
        if (!$("#toggleGlyph").is(':checked')) {
            toggleGlyph = "radialGlyph"
        } else {
            toggleGlyph = "flowerGlyph"
        }

        if (!$("#toggleDimRedux").is(':checked')) {
            toggleDimRedux = "TSNE"
        } else {
            toggleDimRedux = "PCA"
        }

        if (!$("#toggleDGrid").is(':checked')) {
            toggleDGrid = true
        } else {
            toggleDGrid = false
        }

        if (!$("#toggleLabels").is(':checked')) {
            toggleLabels = false
        } else {
            toggleLabels = true
        }

        if (!$("#toggleSvgGrid").is(':checked')) {
            toggleSvgGrid = true
        } else {
            toggleSvgGrid = false
        }

        //number spinner for knn param +/-
        $(document).ready(function() {
                const min = 1
                const max = ids.length
                k = $('.num-in span').parents('.num-block').find('input.in-num').val()
                $('.num-in span').click(function() {
                    var $input = $(this).parents('.num-block').find('input.in-num')
                    if ($(this).hasClass('minus')) {
                        var count = parseFloat($input.val()) - 1
                        count = count < min ? 1 : count
                        if (count == min) {
                            $(this).addClass('dis')
                        } else {
                            $(this).removeClass('dis')
                        }
                        $input.val(count)
                    } else {
                        var count = parseFloat($input.val()) + 1
                        count = count > max ? max : count
                        $input.val(count)
                        if (count == max) {
                            $(this).parents('.num-block').find(('.minus')).removeClass('dis')
                        }
                    }
                    $input.change()
                    return false
                })

                // auto update the button for k param when input goes above the range
                $('.num-in span').parents('.num-block').find('input.in-num').on("change", () => {
                    k = $('.num-in span').parents('.num-block').find('input.in-num').val()
                    if (k < 1) {
                        $('.num-in span').parents('.num-block').find('input.in-num').val(1)
                    } else if (k > 150) {
                        $('.num-in span').parents('.num-block').find('input.in-num').val(150)
                    }
                })
            })

        glyphColor = $("input:checkbox[name=colorCheckbox]").attr("value")

        if (!$("#lckCheckBox").is(':checked')){
            lckChecked = false
        }
        else {
            lckChecked = true
        }

        if (!$("#brtCheckBox").is(':checked')){
            brtChecked = false
        }
        else {
            brtChecked = true
        }

        if (!$("#accCheckBox").is(':checked')){
            accChecked = false
        }
        else {
            accChecked = true
        }

        if (!$("#gyrCheckBox").is(':checked')){
            gyrChecked = false
        }
        else {
            gyrChecked = true
        }

        if (!$("#sleepNoiseCheckBox").is(':checked')){
            noiseChecked = false
        }
        else {
            noiseChecked = true
        }
    }


    // jquery handlers for regreshing charts after resizing
    {
        // auto refresh after window resizing
        jQuery(function($) {
            var windowWidth = $(window).width()
            var windowHeight = $(window).height()
            var id
            $(window).resize(function() {
                clearTimeout(id)
                id = setTimeout(doneResizing, 500)
            })

            function doneResizing() {
                if (windowWidth != $(window).width() || windowHeight != $(window).height()) {
                    location.reload()
                    return
                }
            }
        })

        // refresh after the side open or close using menu click event
        var a = document.getElementById("menu")
        a.addEventListener("click", function() {
            renderCharts(500)
        }, false)

    }

    // jquery handlers for the input types in the Menu
    {   
        $('#searchSelector').change(function () {
            selectedId = $('#searchSelector').val()
        });

        //range slider 
        var slider = document.getElementById("myRange")
            var output = document.getElementById("sliderVal")
            output.innerHTML = slider.value
            slider.oninput = function() {
                radius = this.value
                output.innerHTML = radius
            }

        // switch to select glyphs
        $("#toggleGlyph").on('change', function() {
                if (!$(this).is(':checked')) {
                    toggleGlyph = "radialGlyph"
                    $("#radialSwitch").addClass("selectedLabel")
                    $("#flowerSwitch").removeClass("selectedLabel")
                } else {
                    toggleGlyph = "flowerGlyph"
                    $("#radialSwitch").removeClass("selectedLabel")
                    $("#flowerSwitch").addClass("selectedLabel")
                }
            })

        // switch to select the type of dimensionality reduction
        $("#toggleDimRedux").on('change', function() {
                if (!$(this).is(':checked')) {
                    toggleDimRedux = "TSNE"
                    $("#tsneSwitch").addClass("selectedLabel")
                    $("#pcaSwitch").removeClass("selectedLabel")
                } else {
                    toggleDimRedux = "PCA"
                    $("#tsneSwitch").removeClass("selectedLabel")
                    $("#pcaSwitch").addClass("selectedLabel")
                }
            })

        // switch to use DGrid to remove overlap over the glyphs
        $("#toggleDGrid").on('change', function() {
                if (!$(this).is(':checked')) {
                    toggleDGrid = true
                    $("#useDGrid").addClass("selectedLabel")
                    $("#noUseDGrid").removeClass("selectedLabel")
                } else {
                    toggleDGrid = false
                    $("#useDGrid").removeClass("selectedLabel")
                    $("#noUseDGrid").addClass("selectedLabel")
                }
            })

        // switch to show or hide labels
        $("#toggleLabels").on('change', function() {
                if (!$(this).is(':checked')) {
                    toggleLabels = false
                    $("#hideLabels").addClass("selectedLabel")
                    $("#showLables").removeClass("selectedLabel")
                } else {
                    toggleLabels = true
                    $("#hideLabels").removeClass("selectedLabel")
                    $("#showLables").addClass("selectedLabel")
                }
            })

        // switch to show or hide grid
        $("#toggleSvgGrid").on('change', function() {
                if (!$(this).is(':checked')) {
                    toggleSvgGrid = true
                    $("#showSvgGrid").addClass("selectedLabel")
                    $("#hideSvgGrid").removeClass("selectedLabel")
                } else {
                    toggleSvgGrid = false
                    $("#hideSvgGrid").addClass("selectedLabel")
                    $("#showSvgGrid").removeClass("selectedLabel")
                }
            })

        // checkboxes to select glyph coloring column
        $("input:checkbox[name=colorCheckbox]").on('click', function() {
            var $box = $(this);
            if ($box.is(":checked")) {
                var group = "input:checkbox[name=colorCheckbox]";
                $(group).prop("checked", false);
                $box.prop("checked", true);
                glyphColor = $box.attr("value")
            }
        else {
            $box.prop("checked", true);
            }
        });

        // checkbox to select gyroscope lockstate:  Decided not to implement this feature
        $("#lckCheckBox").on('change', function() {
            if (!$(this).is(':checked')) {
                lckChecked = false
            } else {
                lckChecked = true
            }
        });

        // checkbox to select brightness
        $("#brtCheckBox").on('change', function() {
            if (!$(this).is(':checked')) {
                brtChecked = false
            } else {
                brtChecked = true
            }
        });

        // checkbox to select accelerometer
        $("#accCheckBox").on('change', function() {
            if (!$(this).is(':checked')) {
                accChecked = false
            } else {
                accChecked = true
            }
        });

        // checkbox to select gyroscope
        $("#gyrCheckBox").on('change', function() {
            if (!$(this).is(':checked')) {
                gyrChecked = false
            } else {
                gyrChecked = true
            }
        });

        // checkbox to select sleepNoise
        $("#sleepNoiseCheckBox").on('change', function() {
            if (!$(this).is(':checked')) {
                noiseChecked = false
            } else {
                noiseChecked = true
            }
        });

        // submit button
        $("#Submit").click(function() {
                featurelist = $('#featureSelect').val()
                w = Math.floor($('.svg1')[0].getBoundingClientRect().width)
                h = Math.floor($('.svg1')[0].getBoundingClientRect().height)
                    // radius = +document.getElementById("myRange").value
                var postForm = {
                    "featureColumns": featurelist,
                    "width": w,
                    "height": h,
                    "radius": radius,
                    "k": k,
                    "toggleDimRedux": toggleDimRedux,
                    "toggleDGrid": toggleDGrid
                }
                $.ajax({
                    type: "POST",
                    contentType: 'application/json',
                    data: JSON.stringify(postForm),
                    url: "/dimReduceIds",
                    success: function(status) {
                        if (status === "status1:fileUpdated") {
                            // console.log("FeatureData file updated")
                        }
                        if (status === "status2:singleColumn") {
                            $('#featureSelect').val(['sepal_length', 'sepal_width', 'petal_length', 'petal_width'])
                            $('#featureSelect').multiselect("refresh")
                            alert("Please select more than one column in Feature selection drop down!!!")
                            // console.log("FeatureData file reset: single column selected")
                        }
                    }
                })
                renderCharts(4 * delayInMilliseconds)

                //uncomment below line to hide the sidebar after submit button
                // $("#sidebar").removeClass("show")
            })
    }

    // Funtion to plot the charts
    function renderCharts(delay = delayInMilliseconds) {
            $("body").css("cursor", "wait")
                //calling method that plots buffering symbol
            buffering(glyphsChart, selectedId, toggleText = false)
            buffering(parallelCordChart1, selectedId)
            buffering(parallelCordChart2, selectedId)
            buffering(radialTimeChart, selectedId, toggleText=false)

            setTimeout(function() {
                //code to be executed after delay
                updateGlyphs(glyphsChart, parallelCordChart, selectedId, featurelist, radius, toggleGlyph, toggleLabels, toggleSvgGrid)
                updateParallelCord(parallelCordChart, selectedId, [], featurelist)
                $("body").css("cursor", "default")
            }, delay)
        }

    // jquery handlers for showing the raw data in a tabluar form below all the charts
    // Table for showing raw data
    { 
        // code for rendering csv data on the screen
        var columnDefs = [
                {   headerName: "",
                    children:[{field: 'participantId'}, {field: 'date'}]
                },
                {
                    headerName: 'screenFeatures',
                    children: [{field: 'noScreenLocks', filter: 'agNumberColumnFilter'}, {field: 'firstScreenUnlock', filter: 'agNumberColumnFilter'}, {field: 'lastScreenLock', filter: 'agNumberColumnFilter'}, {field: 'maxScreenTime', filter: 'agNumberColumnFilter'}, {field: 'totalScreenTime', filter: 'agNumberColumnFilter'}]
                },
                {
                    headerName: 'callingFeatures',
                    children: [{field: 'noMissed'}, {field: 'noDialled'}, {field: 'noIncoming'}, {field: 'minDurationIncoming'}, {field: 'maxDurationIncoming'}, {field: 'totalDurationIncoming'}, {field: 'noOutgoing'}, {field: 'minDurationOutgoing'}, {field: 'maxDurtaionOutgoing'}, {field: 'totalDurationOutgoing'}, {field: 'totalNoCalls'}, {field: 'totalDurationCalls'}]
                },
                // {
                //     headerName: 'mobilityFeatures',
                //     children: [{field: 'stepCount'}, {field: 'totalDistance'}, {field: 'noStayPoints'}, {field: 'locationVariance'}, {field: 'locationEntropy'}]
                // },
                {
                    headerName: 'sleepFeatures',
                    children: [{field: 'sleepStartTime1'}, {field: 'sleepEndTime1'}, {field: 'sleepDuration1'}]
                }
            ];

            // fields = ['participantId', 'date', 'depressionScore', 'firstScreenUnlock', 'lastScreenLock', 'locationEntropy', 'locationVariance', 'maxDurationIncoming', 'maxDurtaionOutgoing', 'maxScreenTime', 'minDurationIncoming', 'minDurationOutgoing', 'noDialled', 'noIncoming', 'noMissed', 'noOutgoing', 'noScreenLocks', 'noSleepInterruptions', 'noStayPoints', 'sleepDuration1', 'sleepDuration2', 'sleepEndTime1', 'sleepEndTime2', 'sleepStartTime1', 'sleepStartTime2', 'stepCount', 'totalDistance', 'totalDurationCalls', 'totalDurationIncoming', 'totalDurationOutgoing', 'totalNoCalls', 'totalScreenTime', 'totalSleepDuration']
            // for (var i=0; i<fields.length; i++ ){
            //     columnDefs.push({"field": fields[i]})
            // }

            // let the grid know which columns to use
            const gridOptions = {
            // Group columns
            groupHeaderHeight: 40,
            // Label columns
            headerHeight: 40,

            defaultColDef: {
            // flex: 1,
            minWidth: 100,
            sortable: true,
            filter: true,
            resizable: true,
            // editable: true,
            },

            debug: false,
            columnDefs: columnDefs,
            rowData: null,
            sideBar: true,
            enableCellChangeFlash: true,
            rowDragManaged: true,
            enterMovesDownAfterEdit: true,
            enterMovesDown: true,
            };
        
        function onBtnImport() {
            if ($('div.grid').is(':empty')) {
                var el   = document.getElementById("chart4"); // or other selector like querySelector()
                var rect = el.getBoundingClientRect(); // get the bounding rectangle
                $("#csvGrid").css("display", "block")
                $("#csvGrid").width(rect.width)
                $("#csvGrid").height(rect.width / 2)

                var gridDiv = document.querySelector('#csvGrid');
                
                new agGrid.Grid(gridDiv, gridOptions);
                    $.ajax({
                        type: "GET",
                        url: '/dataTable',
                        async: false,
                        success : function(data) {
                            gridOptions.api.setRowData(data)
                        }
                    });
            }
            else {
                alert('Table already loaded');
            }
        }

        function onBtnRemove(){
            $("#csvGrid").css("display", "none")
            $("#showcsv").css("visibility", "visible")
            $("#hidecsv").css("visibility", "hidden")
            $("#downloadcsv").css("visibility", "hidden")
            $("#updatecsv").css("visibility", "hidden")
            $("#csvGrid").children("div").eq(0).remove();
            location.reload();
        }

        // function onBtnUpdate() {
        // // document.querySelector('#csvResult').value = gridOptions.api.getDataAsCsv();
        // data = gridOptions.api.getDataAsCsv();
        // $.ajax({
        //             type: "POST",
        //             contentType: 'application/json',
        //             data: JSON.stringify(data),
        //             url: "/dataTable",
        //             success: function(status) {
        //                 console.log(status)
        //             }
        //         });
        // }

        // function onBtnExport() {
        //     $("#downloadcsv").css("visibility", "hidden")
        //     gridOptions.api.exportDataAsCsv();
        // }
    }
    </script>
</body>
</html>